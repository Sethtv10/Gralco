<!DOCTYPE html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Pago</title>



    <!-- Tell the browser to be responsive to screen width -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="./ERP/assets/AdminLTE/plugins/fontawesome-free/css/all.min.css">
    <!-- Ionicons -->
    <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <!-- Theme style -->
    <link rel="stylesheet" href="./ERP/assets/AdminLTE/dist/css/adminlte.min.css">

    <link rel="stylesheet" href="./ERP/application/css/ERP.css">
    <!-- Google Font: Source Sans Pro -->
    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700" rel="stylesheet">
</head>

<body class="hold-transition sidebar-mini">





    <style type="text/css" media="screen">

    </style>

    <div class="row">
        <div class="col-md-12" style="padding-right: 30px;padding-left: 30px;padding-top: 20px;">

            <script type="text/javascript" src="https://openpay.s3.amazonaws.com/openpay.v1.min.js"></script>
            <script type='text/javascript' src="https://openpay.s3.amazonaws.com/openpay-data.v1.min.js"></script>


            <style>
                @charset "US-ASCII";
                @import "http://fonts.googleapis.com/css?family=Lato:300,400,700";

                * {
                    color: #444;
                    font-family: Lato;
                    font-size: 16px;
                    font-weight: 300;
                }

                #amount {
                    pointer-events: none;
                }

                ::-webkit-input-placeholder {
                    font-style: italic;
                }

                :-moz-placeholder {
                    font-style: italic;
                }

                ::-moz-placeholder {
                    font-style: italic;
                }

                :-ms-input-placeholder {
                    font-style: italic;
                }

                body {
                    float: left;
                    margin: 0;
                    padding: 0;
                    width: 100%;
                }

                strong {
                    font-weight: 700;
                }

                a {
                    cursor: pointer;
                    display: block;
                    text-decoration: none;
                }

                a.button {
                    border-radius: 5px 5px 5px 5px;
                    -webkit-border-radius: 5px 5px 5px 5px;
                    -moz-border-radius: 5px 5px 5px 5px;
                    text-align: center;
                    font-size: 21px;
                    font-weight: 400;
                    padding: 12px 0;
                    width: 100%;
                    display: table;
                    background: #E51F04;
                    background: -moz-linear-gradient(top, #E51F04 0%, #A60000 100%);
                    background: -webkit-gradient(linear, left top, left bottom, color-stop(0%, #E51F04), color-stop(100%, #A60000));
                    background: -webkit-linear-gradient(top, #E51F04 0%, #A60000 100%);
                    background: -o-linear-gradient(top, #E51F04 0%, #A60000 100%);
                    background: -ms-linear-gradient(top, #E51F04 0%, #A60000 100%);
                    background: linear-gradient(top, #E51F04 0%, #A60000 100%);
                    filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#E51F04', endColorstr='#A60000', GradientType=0);
                }

                a.button i {
                    margin-right: 10px;
                }

                a.button.disabled {
                    background: none repeat scroll 0 0 #ccc;
                    cursor: default;
                }

                .bkng-tb-cntnt {
                    float: left;

                }

                .bkng-tb-cntnt a.button {
                    color: #fff;
                    float: right;
                    font-size: 18px;
                    padding: 5px 20px;
                    width: auto;
                }

                .bkng-tb-cntnt a.button.o {
                    background: none repeat scroll 0 0 rgba(0, 0, 0, 0);
                    color: #e51f04;
                    border: 1px solid #e51f04;
                }

                .bkng-tb-cntnt a.button i {
                    color: #fff;
                }

                .bkng-tb-cntnt a.button.o i {
                    color: #e51f04;
                }

                .bkng-tb-cntnt a.button.right i {
                    float: right;
                    margin: 2px 0 0 10px;
                }

                .bkng-tb-cntnt a.button.left {
                    float: left;
                }

                .bkng-tb-cntnt a.button.disabled.o {
                    border-color: #ccc;
                    color: #ccc;
                }

                .bkng-tb-cntnt a.button.disabled.o i {
                    color: #ccc;
                }

                .pymnts {
                    float: left;

                }

                .pymnts * {
                    float: left;
                }

                .sctn-row {
                    margin-bottom: 35px;

                }

                .sctn-col {
                    width: 375px;
                }

                .sctn-col.l {
                    width: 425px;
                }

                .sctn-col input {
                    border: 1px solid #ccc;
                    font-size: 18px;
                    line-height: 24px;
                    padding: 10px 12px;
                    width: 333px;
                }

                .sctn-col label {
                    font-size: 24px;
                    line-height: 24px;
                    margin-bottom: 10px;
                    width: 100%;
                }


                .sctn-col.x3 a {
                    float: right;
                }



                .pymnt-itm h2 {
                    background-color: #e9e9e9;
                    font-size: 24px;
                    line-height: 24px;
                    margin: 0;
                    padding: 28px 0 28px 20px;

                }

                .pymnt-itm.active h2 {
                    background-color: #e51f04;
                    color: #fff;
                    cursor: default;
                }

                .pymnt-itm div.pymnt-cntnt {
                    display: none;
                }

                .pymnt-itm.active div.pymnt-cntnt {
                    background-color: #f7f7f7;
                    display: block;
                    padding: 0 0 30px;
                    width: 100%;
                }

                .pymnt-cntnt div.sctn-row {
                    margin: 20px 30px 0;

                }




                .pymnt-cntnt div.sctn-row div.sctn-col.cvv {
                    background-image: url("./ERP/assets/OpenPay/cvv.png");
                    background-position: 156px center;
                    background-repeat: no-repeat;
                    padding-bottom: 30px;
                }




                .openpay div.logo {
                    background-image: url("./ERP/assets/OpenPay/openpay.png");
                    background-position: left bottom;
                    background-repeat: no-repeat;
                    border-right: 1px solid #ccc;
                    font-size: 12px;
                    font-weight: 400;
                    height: 65px;
                    padding: 15px 20px 0 0;
                }

                .openpay div.shield {
                    background-image: url("./ERP/assets/OpenPay/security.png");
                    background-position: left bottom;
                    background-repeat: no-repeat;
                    font-size: 12px;
                    font-weight: 400;

                    padding: 20px 0 0 40px;

                }



                .card-expl div {
                    background-position: left 45px;
                    background-repeat: no-repeat;
                    height: 80px;
                    padding-top: 10px;

                }

                .card-expl div.debit {
                    background-image: url("./ERP/assets/OpenPay/cards2.png");

                    background-size: contain;


                }

                .card-expl div.credit {
                    background-image: url("./ERP/assets/OpenPay/cards1.png");
                    border-right: 1px solid #ccc;

                    width: 209px;
                }

                .card-expl h4 {
                    font-weight: 400;
                    margin: 0;
                    font-size: 20px;
                }
            </style>

            <form action="#" method="POST" id="payment-form">
                <input type="hidden" name="token_id" id="token_id">

                <div class="card ">
                    <div class="card-header">
                        <h3 class="card-title">Formulario de Registro</h3>

                        <div class="card-tools">

                        </div>
                        <!-- /.card-tools -->
                    </div>
                    <!-- /.card-header -->
                    <div class="card-body">

                        <div class="row">
                            <div class="col-12">
                                <!-- select -->
                                <div class="form-group">
                                    <label>Paquete</label>
                                    <select class="form-control" name="description" id="description">

                                    </select>
                                </div>


                            </div>
                            <div class="col-12">
                                <!-- select -->
                                <div class="form-group">
                                    <label>Precio</label>
                                    <select class="form-control" name="amount" id="amount" readonly>

                                    </select>
                                </div>


                            </div>

                            <div class="col-lg-6">
                                <!-- select -->
                                <div class="form-group">
                                    <label>Nombre</label>
                                    <input class="form-control" type="text" name="name" id="name">
                                </div>


                            </div>

                            <div class="col-lg-6">
                                <!-- select -->
                                <div class="form-group">
                                    <label>Apellido</label>
                                    <input class="form-control" type="text" name="last_name" id="last_name">
                                </div>


                            </div>

                            <div class="col-12">
                                <!-- select -->
                                <div class="form-group">
                                    <label>Correo</label>
                                    <input class="form-control" type="email" name="email" id="email" value="">
                                </div>


                            </div>

                            <div class="col-lg-6">
                                <!-- select -->
                                <div class="form-group">
                                    <label>Constraseña</label>
                                    <input class="form-control" type="password" name="password" id="password">
                                </div>


                            </div>

                            <div class="col-lg-6">
                                <!-- select -->
                                <div class="form-group">
                                    <label>Confirma Constraseña</label>
                                    <input class="form-control" type="password" name="password2" id="password2">
                                </div>


                            </div>




                        </div>


                        <div class="card-expl row">
                            <div class="credit col-md-6">
                                <h4>Tarjetas de crédito</h4>
                            </div>
                            <div class="debit col-md-6">
                                <h4>Tarjetas de débito</h4>
                            </div>
                        </div>


                        <div class="row">
                            <div class="col-md-6">
                                <label>Nombre del titular</label><input type="text" class="form-control"
                                    placeholder="Como aparece en la tarjeta" autocomplete="off" id="holder_name"
                                    name="holder_name" data-openpay-card="holder_name">
                            </div>
                            <div class="col-md-6">
                                <label>Número de tarjeta</label><input type="text" class="form-control" maxlength="16"
                                    id="card_number" name="card_number" autocomplete="off"
                                    data-openpay-card="card_number"></div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <label>Fecha de expiración</label>

                            </div>
                            <div class="col-md-6"><label>Código de seguridad</label> </div>
                        </div>
                        <div class="row">
                            <div class="col-md-2 col-4"><input type="text" class="form-control" maxlength="2"
                                    placeholder="Mes" id="expiration_month" name="expiration_month"
                                    data-openpay-card="expiration_month"></div>
                            <div class="col-md-2 col-4"><input type="text" class="form-control" maxlength="2"
                                    placeholder="Año" id="expiration_year" name="expiration_year"
                                    data-openpay-card="expiration_year"></div>

                            <div class="col-md-3 col-6"><input type="password" class="form-control" maxlength="3"
                                    placeholder="3 dígitos" id="cvv2" name="cvv2" autocomplete="off"
                                    data-openpay-card="cvv2"></div>


                        </div>
                    </div>
                    <div class="card-footer">

                        <div class="row">
                            <div class="col-6">
                                <div class="openpay">
                                    <div class="logo">Transacciones realizadas vía:</div>
                                    <div class="shield">Tus pagos se realizan de forma segura con encriptación de 256
                                        bits
                                    </div>
                                </div>
                            </div>
                            <div class="col-6">
                                <button class="btn btn-danger float-right" id="pay-button">Pagar</button>
                            </div>
                        </div>
                    </div>

                </div>
            </form>


        </div>
    </div>






    <!-- jQuery-->
    <script src="./ERP/assets/AdminLTE/plugins/jquery/jquery.min.js"></script>
    <!-- Bootstrap 4 -->
    <script src="./ERP/assets/AdminLTE/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
    <!-- ChartJS -->
    <script src="./ERP/assets/AdminLTE/plugins/chart.js/Chart.min.js"></script>
    <!-- AdminLTE App -->
    <script src="./ERP/assets/AdminLTE/dist/js/adminlte.min.js"></script>
    <!-- AdminLTE for demo purposes -->
    <script src="./ERP/assets/AdminLTE/dist/js/demo.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>
    <script>




        const Toast = Swal.mixin({
            toast: true,
            position: 'top-end',
            showConfirmButton: false,
            timer: 3000,
            timerProgressBar: true,
            onOpen: (toast) => {
                toast.addEventListener('mouseenter', Swal.stopTimer)
                toast.addEventListener('mouseleave', Swal.resumeTimer)
            }
        })


        /* 
        
     $(function() {
         const Toast = Swal.mixin({
           toast: true,
           position: 'top-end',
           showConfirmButton: false,
           timer: 3000
         });
     Toast.fire({
           icon: 'error',
        
             title: 'Lorem ipsum dolor sit amet, consetetur sadipscing elitr.'
           });
       */


        const formatter = new Intl.NumberFormat('en-US', {
            style: 'currency',
            currency: 'USD',
            minimumFractionDigits: 2
        })

        // "$1,000.00"




        document.querySelector('#amount').addEventListener('change', function () {

            var amount = document.querySelector("#amount");

            amount.innerHTML.match("^(?!0\.00)\d{1,3}(,\d{3})*(\.\d\d)?$");


        });



        document.querySelector('#description').addEventListener('change', function (e) {

            var amount = document.querySelector("#amount");

            amount.selectedIndex = e.target.selectedIndex;


        });




        $(document).ready(function () {




            var xmlhttp = new XMLHttpRequest();
            xmlhttp.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    var response = JSON.parse(this.response);
                    document.querySelector("#description").innerHTML = response.packs;
                    document.querySelector("#amount").innerHTML = response.prices;
                    document.querySelector("#amount").readOnly = true;
                }
            };
            xmlhttp.open("GET", "./ERP/index.php/PublicController/getSelects", true);
            xmlhttp.send();







            var amount = document.querySelector("#amount");

            Array.from(amount.options).map(function (option) {
                var numberform = formatter.format(option.innerHTML);
                option.innerHTML = numberform;

            });




            OpenPay.setId('mzmgumh60micq3symimk');
            OpenPay.setApiKey('pk_4fb26aee17f840ca89b7ac5161b8733b');
            OpenPay.setSandboxMode(true);
            //Se genera el id de dispositivo
            var deviceSessionId = OpenPay.deviceData.setup("payment-form", "deviceIdHiddenFieldName");

            $('#pay-button').on('click', function (event) {
                event.preventDefault();


                if (document.getElementById("password").value == document.getElementById("password2").value) {
                    OpenPay.token.extractFormAndCreate('payment-form', sucess_callbak, error_callbak);
                } else {
                    Toast.fire({
                        icon: 'error',
                        title: 'Las contraseñas no coinciden.'
                    });

                    document.getElementById("pay-button").disabled = false;
                }

            });

            var sucess_callbak = function (response) {
                var token_id = response.data.id;
                $('#token_id').val(token_id);
                //$('#payment-form').submit();
                var str = "card_number=" + document.getElementById('card_number').value + "&token_id=" +
                    token_id + "&amount=" + document.getElementById('amount').value +
                    "&description=" + document.getElementById('description').value +
                    "&deviceIdHiddenFieldName=" + deviceSessionId;




                var form = $("#payment-form").serializeArray();
                var obj = {};
                for (var a = 0; a < form.length; a++) {
                    obj[form[a].name] = form[a].value;
                }



                var data = JSON.stringify(obj);
                var xmlhttp = new XMLHttpRequest();
                xmlhttp.onreadystatechange = function () {
                    if (this.readyState == 4 && this.status == 200) {


                        if (this.responseText == "") {
                            Swal.fire({
                                icon: 'success',
                                title: '¡Increible!',
                                text: 'Acabas de comenzar un gran viaje',
                                onClose: () => {
                                    location.replace("./ERP");
                                }
                                //footer: '<a href>Why do I have this issue?</a>'
                            })
                        } else {
                            Toast.fire({
                                icon: 'error',
                                title: this.responseText
                            });
                        }
                        document.getElementById("pay-button").disabled = false;
                    }
                    if (this.readyState == 2 && this.status == 500) {


                        Toast.fire({
                            icon: 'error',
                            title: 'Error en la suscripción.'
                        });
                        document.getElementById("pay-button").disabled = false;
                    }
                };
                xmlhttp.open("POST", "./ERP/index.php/PublicController/suscribeUser", true);
                xmlhttp.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
                xmlhttp.send(data);
                /* $.ajax({url: "./php/registro.php?" + str,
                type: "post",
                success: 
                    function(result){
                    alert(result);
                    }
                }); */
            };

            var error_callbak = function (response) {
                var desc = response.data.description != undefined ? response.data.description : response
                    .message;
                alert("ERROR [" + response.status + "] " + desc);
                $("#pay-button").prop("disabled", false);
            };

        });
    </script>


<script language="javascript">

    var callingURL = document.URL;

    //Separamos los parametros
    var cgiString = callingURL.substring(callingURL.indexOf('?')+1,callingURL.length);

    if (cgiString.indexOf('#')!=-1){
        newUrl = cgiString.slice(0,cgiString.indexOf('#'));
    }else{
        newUrl = "";
    }
  

    newUrl = cgiString.replace(newUrl,'');

    if( newUrl == "#expirado"){
        Toast.fire({
                            icon: "error",
                            title: "Tu suscripción expiro hace  días, por favor realiza la renovación."
                        });
                    
                       
    }
</script>

</body>

</html>



